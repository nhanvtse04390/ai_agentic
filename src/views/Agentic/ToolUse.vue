<!-- üü° Seminar Presentation Section Start -->
<!-- 
  üé§ Ch·ªß ƒë·ªÅ: Tool Use - FE l√† ng∆∞·ªùi quy·∫øt ƒë·ªãnh c√°ch tools ƒë∆∞·ª£c hi·ªÉn th·ªã v√† t∆∞∆°ng t√°c
  AI ch·ªçn tool, nh∆∞ng FE m·ªõi khi·∫øn tool ƒë√≥ tr·ªü n√™n d·ªÖ d√πng v√† ƒë·∫πp m·∫Øt
-->
<template>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900 p-6">
    <div class="max-w-6xl mx-auto">
      <!-- üü° Seminar Intro Slide -->
      <section class="seminar-intro mb-8 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl p-6 border-2 border-purple-200 dark:border-purple-800">
        <div class="text-center mb-6">
          <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-3 animate-pulse">
            üîß Tool Use: AI ch·ªçn tool, FE khi·∫øn n√≥ ƒë·∫πp v√† d·ªÖ d√πng
          </h2>
          <img 
            src="https://i.imgflip.com/8zwv5a.jpg" 
            alt="meme tool use" 
            class="mx-auto rounded-xl w-80 max-w-full my-4 shadow-lg"
            loading="lazy"
          />
          <p class="text-lg text-gray-700 dark:text-gray-300 mt-4 max-w-3xl mx-auto">
            AI c√≥ th·ªÉ ch·ªçn tool v√† arguments. Nh∆∞ng <span class="font-bold text-purple-600 dark:text-purple-400">Frontend Developer</span> m·ªõi l√† ng∆∞·ªùi quy·∫øt ƒë·ªãnh tool ƒë√≥ ƒë∆∞·ª£c hi·ªÉn th·ªã nh∆∞ th·∫ø n√†o: loading state, error handling, success animation, v√† c√°ch integrate v√†o flow c·ªßa user. üé®
          </p>
        </div>

        <!-- üí¨ Speaker Notes -->
        <aside class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4 rounded-r-lg mt-6">
          <h3 class="font-semibold text-lg mb-3 flex items-center gap-2">
            üí¨ Speaker Notes
          </h3>
          <ul class="list-disc list-inside text-gray-700 dark:text-gray-300 space-y-2 text-sm">
            <li>"AI bi·∫øt 'c·∫ßn d√πng calculator', nh∆∞ng FE m·ªõi l√†m cho n√≥ c√≥ button ƒë·∫πp, keyboard shortcuts, v√† visual feedback khi t√≠nh to√°n."</li>
            <li>"Tool execution kh√¥ng ch·ªâ l√† 'g·ªçi function' - n√≥ l√† c·∫£ m·ªôt journey: loading, success, error handling, v√† c√°ch hi·ªÉn th·ªã result."</li>
            <li>"FE l√† ng∆∞·ªùi quy·∫øt ƒë·ªãnh UX c·ªßa tools. AI cung c·∫•p logic, nh∆∞ng FE l√†m cho n√≥ feel good."</li>
            <li>"Demo n√†y cho th·∫•y: AI ch·ªçn tool, nh∆∞ng UI m·ªõi khi·∫øn n√≥ tr·ªü n√™n intuitive v√† delightful."</li>
          </ul>
        </aside>
      </section>
      <!-- üü° Seminar Presentation Section End -->

      <!-- Original Demo Section (unchanged) -->
      <div class="border-t-2 border-gray-200 dark:border-gray-700 pt-8 mt-8">
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Tool Use Demo
          </h1>
          <p class="text-gray-600 dark:text-gray-400">
            AI ch·ªçn tool v√† arguments, frontend th·ª±c thi tool
          </p>
        </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Input Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Request</h2>
          <textarea
            v-model="userRequest"
            placeholder="Y√™u c·∫ßu AI s·ª≠ d·ª•ng tool (v√≠ d·ª•: 'T√≠nh 15 + 27', 'L·∫•y d·ªØ li·ªáu user', 'V·∫Ω bi·ªÉu ƒë·ªì')..."
            class="w-full h-32 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          ></textarea>
          <button
            @click="processRequest"
            :disabled="isProcessing || !userRequest.trim()"
            class="mt-4 w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            {{ isProcessing ? 'ƒêang x·ª≠ l√Ω...' : 'X·ª≠ l√Ω' }}
          </button>

          <!-- Available Tools -->
          <div class="mt-6">
            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
              Available Tools:
            </h3>
            <div class="space-y-2 text-sm">
              <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                <span class="font-medium">calculator</span> - T√≠nh to√°n s·ªë h·ªçc
              </div>
              <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                <span class="font-medium">fetchMockData</span> - L·∫•y d·ªØ li·ªáu mock
              </div>
              <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                <span class="font-medium">generateChart</span> - T·∫°o bi·ªÉu ƒë·ªì
              </div>
            </div>
          </div>
        </div>

        <!-- Result Area -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">K·∫øt qu·∫£</h2>
          
          <div v-if="toolResult" class="space-y-4">
            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                Tool ƒë∆∞·ª£c ch·ªçn
              </div>
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                {{ toolResult.tool }}
              </div>
            </div>

            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                Arguments
              </div>
              <pre class="text-sm bg-gray-900 text-green-400 p-3 rounded overflow-x-auto">{{ JSON.stringify(toolResult.args, null, 2) }}</pre>
            </div>

            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                K·∫øt qu·∫£ th·ª±c thi
              </div>
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                {{ toolResult.result }}
              </div>
            </div>

            <!-- Chart preview (n·∫øu l√† generateChart) -->
            <div v-if="toolResult.tool === 'generateChart' && chartData" class="mt-4">
              <div class="h-64 bg-gray-100 dark:bg-gray-900 rounded flex items-center justify-center">
                <div class="text-center">
                  <div class="text-2xl font-bold text-gray-700 dark:text-gray-300 mb-2">
                    üìä Chart Preview
                  </div>
                  <div class="text-sm text-gray-500">
                    {{ chartData.type }} chart v·ªõi {{ chartData.dataPoints }} data points
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-else class="text-center py-12 text-gray-400">
            K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
          </div>
        </div>
      </div>

      <!-- Agent Console -->
      <div class="mt-6 bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Agent Console</h2>
        <ConsoleLog :logs="consoleLogs" :is-thinking="isProcessing" />
      </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { sendPrompt } from '@/utils/ai';
import ConsoleLog from '@/components/agentic/ConsoleLog.vue';

const userRequest = ref('');
const isProcessing = ref(false);
const toolResult = ref(null);
const chartData = ref(null);
const consoleLogs = ref([]);

// Tool definitions
const tools = {
  calculator: (args) => {
    const { operation, a, b } = args;
    switch (operation) {
      case 'add': return a + b;
      case 'subtract': return a - b;
      case 'multiply': return a * b;
      case 'divide': return b !== 0 ? a / b : 'Error: Division by zero';
      default: return 'Unknown operation';
    }
  },
  
  fetchMockData: async (args) => {
    const { type, count = 5 } = args;
    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 500));
    return {
      type,
      count,
      data: Array.from({ length: count }, (_, i) => ({
        id: i + 1,
        name: `Item ${i + 1}`,
        value: Math.floor(Math.random() * 100)
      }))
    };
  },
  
  generateChart: (args) => {
    const { type, dataPoints = 10 } = args;
    return {
      type,
      dataPoints,
      labels: Array.from({ length: dataPoints }, (_, i) => `Point ${i + 1}`),
      values: Array.from({ length: dataPoints }, () => Math.floor(Math.random() * 100))
    };
  }
};

function addLog(type, message) {
  consoleLogs.value.push({
    type,
    message,
    timestamp: Date.now()
  });
}

async function processRequest() {
  if (!userRequest.value.trim()) return;

  isProcessing.value = true;
  toolResult.value = null;
  chartData.value = null;
  addLog('info', `X·ª≠ l√Ω request: "${userRequest.value}"`);

  try {
    const systemPrompt = `B·∫°n l√† AI assistant c√≥ th·ªÉ s·ª≠ d·ª•ng tools. 
Available tools: calculator, fetchMockData, generateChart.

Khi user y√™u c·∫ßu, h√£y ch·ªçn tool ph√π h·ª£p v√† tr·∫£ v·ªÅ JSON:
{
  "tool": "toolName",
  "args": { ... }
}

V√≠ d·ª•:
- "T√≠nh 15 + 27" ‚Üí {"tool": "calculator", "args": {"operation": "add", "a": 15, "b": 27}}
- "L·∫•y d·ªØ li·ªáu user" ‚Üí {"tool": "fetchMockData", "args": {"type": "user", "count": 5}}
- "V·∫Ω bi·ªÉu ƒë·ªì" ‚Üí {"tool": "generateChart", "args": {"type": "line", "dataPoints": 10}}

Ch·ªâ tr·∫£ v·ªÅ JSON, kh√¥ng c√≥ text kh√°c.`;

    const response = await sendPrompt({
      role: 'system',
      prompt: systemPrompt + '\n\nUser request: ' + userRequest.value,
      context: { request: userRequest.value }
    });

    addLog('success', 'Nh·∫≠n ƒë∆∞·ª£c tool selection t·ª´ AI');

    // Parse JSON
    try {
      const jsonMatch = response.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        const parsed = JSON.parse(jsonMatch[0]);
        const { tool, args } = parsed;

        addLog('info', `Tool ƒë∆∞·ª£c ch·ªçn: ${tool}`);
        addLog('info', `Arguments: ${JSON.stringify(args)}`);

        // Execute tool
        if (tools[tool]) {
          const result = await tools[tool](args);
          toolResult.value = {
            tool,
            args,
            result: typeof result === 'object' ? JSON.stringify(result, null, 2) : String(result)
          };

          if (tool === 'generateChart') {
            chartData.value = result;
          }

          addLog('success', `Tool execution th√†nh c√¥ng`);
        } else {
          throw new Error(`Unknown tool: ${tool}`);
        }
      } else {
        throw new Error('Kh√¥ng t√¨m th·∫•y JSON trong response');
      }
    } catch (e) {
      addLog('error', `L·ªói parse ho·∫∑c execute: ${e.message}`);
      // Fallback
      toolResult.value = {
        tool: 'calculator',
        args: { operation: 'add', a: 5, b: 3 },
        result: '8'
      };
    }
  } catch (error) {
    addLog('error', `L·ªói: ${error.message}`);
  } finally {
    isProcessing.value = false;
  }
}
</script>

