<!-- üü° Seminar Presentation Section Start -->
<!-- 
  üé§ Ch·ªß ƒë·ªÅ: Planning - FE l√† ng∆∞·ªùi bi·∫øn k·∫ø ho·∫°ch c·ªßa AI th√†nh tr·∫£i nghi·ªám c√≥ c·∫£m x√∫c
  AI c√≥ th·ªÉ l·∫≠p k·∫ø ho·∫°ch, nh∆∞ng FE m·ªõi khi·∫øn k·∫ø ho·∫°ch ƒë√≥ th√†nh UI th·ª±c s·ª± "s·ªëng"
-->
<template>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900 p-6">
    <div class="max-w-6xl mx-auto">
      <!-- üü° Seminar Intro Slide -->
      <section class="seminar-intro mb-8 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-xl p-6 border-2 border-green-200 dark:border-green-800">
        <div class="text-center mb-6">
          <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-3 animate-bounce">
            üß© Planning: AI l·∫≠p k·∫ø ho·∫°ch, FE khi·∫øn n√≥ th√†nh tr·∫£i nghi·ªám
          </h2>
          <img 
            src="https://i.imgflip.com/8zwv5a.jpg" 
            alt="meme planning" 
            class="mx-auto rounded-xl w-80 max-w-full my-4 shadow-lg"
            loading="lazy"
          />
          <p class="text-lg text-gray-700 dark:text-gray-300 mt-4 max-w-3xl mx-auto">
            AI c√≥ th·ªÉ t·∫°o multi-step plan chi ti·∫øt. Nh∆∞ng <span class="font-bold text-green-600 dark:text-green-400">Frontend Developer</span> m·ªõi l√† ng∆∞·ªùi bi·∫øn nh·ªØng b∆∞·ªõc ƒë√≥ th√†nh timeline ƒë·∫πp m·∫Øt, progress bar m∆∞·ª£t m√†, v√† interactions khi·∫øn user c·∫£m th·∫•y ƒë∆∞·ª£c h∆∞·ªõng d·∫´n, kh√¥ng b·ªã l·∫°c l·ªëi. üéØ
          </p>
        </div>

        <!-- üí¨ Speaker Notes -->
        <aside class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4 rounded-r-lg mt-6">
          <h3 class="font-semibold text-lg mb-3 flex items-center gap-2">
            üí¨ Speaker Notes
          </h3>
          <ul class="list-disc list-inside text-gray-700 dark:text-gray-300 space-y-2 text-sm">
            <li>"AI gi·ªèi l√™n k·∫ø ho·∫°ch, nh∆∞ng ng∆∞·ªùi FE hi·ªÉu c·∫£m x√∫c c·ªßa ng∆∞·ªùi d√πng. M·ªói b∆∞·ªõc kh√¥ng ch·ªâ l√† 'done' - n√≥ ph·∫£i c√≥ feedback, animation, v√† c·∫£m gi√°c progress."</li>
            <li>"UI l√† n∆°i k·∫ø ho·∫°ch AI tr·ªü n√™n 's·ªëng'. Timeline kh√¥ng ch·ªâ l√† text - n√≥ l√† visual story c·ªßa journey."</li>
            <li>"Ch√∫ng ta kh√¥ng bi·∫øn m·∫•t ‚Äî ta ch·ªâ c·∫ßn h·ªçc n√≥i chuy·ªán v·ªõi AI t·ªët h∆°n. Planning layer cho ta blueprint, nh∆∞ng FE l√† ng∆∞·ªùi x√¢y nh√†."</li>
            <li>"H√£y xem demo - AI t·∫°o plan, nh∆∞ng UI m·ªõi khi·∫øn user c·∫£m th·∫•y ƒë∆∞·ª£c d·∫´n d·∫Øt."</li>
          </ul>
        </aside>
      </section>
      <!-- üü° Seminar Presentation Section End -->

      <!-- Original Demo Section (unchanged) -->
      <div class="border-t-2 border-gray-200 dark:border-gray-700 pt-8 mt-8">
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Planning Demo
          </h1>
          <p class="text-gray-600 dark:text-gray-400">
            AI t·∫°o multi-step plan v√† cho ph√©p execute t·ª´ng b∆∞·ªõc
          </p>
        </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Input Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">M·ª•c ti√™u</h2>
          <textarea
            v-model="goal"
            placeholder="M√¥ t·∫£ m·ª•c ti√™u ho·∫∑c task b·∫°n mu·ªën AI l√™n k·∫ø ho·∫°ch..."
            class="w-full h-32 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          ></textarea>
          <button
            @click="generatePlan"
            :disabled="isGenerating || !goal.trim()"
            class="mt-4 w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            {{ isGenerating ? 'ƒêang t·∫°o k·∫ø ho·∫°ch...' : 'T·∫°o k·∫ø ho·∫°ch' }}
          </button>
        </div>

        <!-- Plan Timeline -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">K·∫ø ho·∫°ch</h2>
          
          <div v-if="planSteps.length > 0">
            <Timeline :steps="planSteps" />
            
            <div class="mt-6 flex gap-2">
              <button
                @click="executeNextStep"
                :disabled="currentStepIndex >= planSteps.length || isExecuting"
                class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                {{ isExecuting ? 'ƒêang th·ª±c thi...' : 'Th·ª±c thi b∆∞·ªõc ti·∫øp theo' }}
              </button>
              <button
                @click="executeAll"
                :disabled="planSteps.length === 0 || isExecuting"
                class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                Th·ª±c thi t·∫•t c·∫£
              </button>
            </div>
          </div>

          <div v-else class="text-center py-12 text-gray-400">
            K·∫ø ho·∫°ch s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
          </div>
        </div>
      </div>

      <!-- Agent Console -->
      <div class="mt-6 bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Agent Console</h2>
        <ConsoleLog :logs="consoleLogs" :is-thinking="isGenerating || isExecuting" />
      </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { sendPrompt } from '@/utils/ai';
import Timeline from '@/components/agentic/Timeline.vue';
import ConsoleLog from '@/components/agentic/ConsoleLog.vue';

const goal = ref('');
const isGenerating = ref(false);
const isExecuting = ref(false);
const planSteps = ref([]);
const currentStepIndex = ref(0);
const consoleLogs = ref([]);

function addLog(type, message) {
  consoleLogs.value.push({
    type,
    message,
    timestamp: Date.now()
  });
}

async function generatePlan() {
  if (!goal.value.trim()) return;

  isGenerating.value = true;
  planSteps.value = [];
  currentStepIndex.value = 0;
  addLog('info', 'B·∫Øt ƒë·∫ßu t·∫°o k·∫ø ho·∫°ch...');
  addLog('info', `M·ª•c ti√™u: "${goal.value}"`);

  try {
    const systemPrompt = `B·∫°n l√† AI planner. T·∫°o k·∫ø ho·∫°ch chi ti·∫øt cho m·ª•c ti√™u ƒë∆∞·ª£c ƒë∆∞a ra.
Tr·∫£ v·ªÅ JSON v·ªõi format:
{
  "steps": [
    {
      "id": 1,
      "name": "T√™n b∆∞·ªõc",
      "description": "M√¥ t·∫£ chi ti·∫øt",
      "status": "pending"
    }
  ]
}
Ch·ªâ tr·∫£ v·ªÅ JSON, kh√¥ng c√≥ text kh√°c.`;

    const response = await sendPrompt({
      role: 'system',
      prompt: systemPrompt + '\n\nM·ª•c ti√™u: ' + goal.value,
      context: { goal: goal.value }
    });

    addLog('success', 'Nh·∫≠n ƒë∆∞·ª£c k·∫ø ho·∫°ch t·ª´ AI');

    // Parse JSON
    try {
      const jsonMatch = response.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        const parsed = JSON.parse(jsonMatch[0]);
        planSteps.value = parsed.steps.map(step => ({
          ...step,
          status: 'pending',
          result: ''
        }));
        addLog('success', `ƒê√£ t·∫°o ${planSteps.value.length} b∆∞·ªõc`);
      } else {
        throw new Error('Kh√¥ng t√¨m th·∫•y JSON trong response');
      }
    } catch (e) {
      // Fallback: t·∫°o mock plan
      planSteps.value = [
        { id: 1, name: 'B∆∞·ªõc 1', description: 'Kh·ªüi t·∫°o v√† chu·∫©n b·ªã', status: 'pending', result: '' },
        { id: 2, name: 'B∆∞·ªõc 2', description: 'X·ª≠ l√Ω d·ªØ li·ªáu', status: 'pending', result: '' },
        { id: 3, name: 'B∆∞·ªõc 3', description: 'T·∫°o k·∫øt qu·∫£', status: 'pending', result: '' }
      ];
      addLog('warning', 'S·ª≠ d·ª•ng mock plan');
    }
  } catch (error) {
    addLog('error', `L·ªói: ${error.message}`);
  } finally {
    isGenerating.value = false;
  }
}

async function executeNextStep() {
  if (currentStepIndex.value >= planSteps.value.length) return;

  isExecuting.value = true;
  const step = planSteps.value[currentStepIndex.value];
  step.status = 'running';
  
  addLog('info', `Th·ª±c thi b∆∞·ªõc ${step.id}: ${step.name}`);

  // Simulate execution (c√≥ th·ªÉ g·ªçi AI ho·∫∑c th·ª±c thi logic th·ª±c t·∫ø)
  await new Promise(resolve => setTimeout(resolve, 1500));

  step.status = 'completed';
  step.result = `ƒê√£ ho√†n th√†nh: ${step.description}`;
  addLog('success', `Ho√†n th√†nh b∆∞·ªõc ${step.id}`);
  
  currentStepIndex.value++;
  isExecuting.value = false;
}

async function executeAll() {
  while (currentStepIndex.value < planSteps.value.length) {
    await executeNextStep();
    await new Promise(resolve => setTimeout(resolve, 500));
  }
}
</script>

