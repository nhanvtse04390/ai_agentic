<!-- üü° Seminar Presentation Section Start -->
<!-- 
  üé§ Ch·ªß ƒë·ªÅ: Perception - FE l√† c·∫ßu n·ªëi gi·ªØa ng∆∞·ªùi v√† AI trong perception layer
  AI c√≥ th·ªÉ "ƒë·ªçc" intent, nh∆∞ng FE m·ªõi khi·∫øn insights ƒë√≥ th√†nh tr·∫£i nghi·ªám c√≥ c·∫£m x√∫c
-->
<template>
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900 p-6">
    <div class="max-w-6xl mx-auto">
      <!-- üü° Seminar Intro Slide -->
      <section class="seminar-intro mb-8 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-6 border-2 border-blue-200 dark:border-blue-800">
        <div class="text-center mb-6">
          <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-3 animate-pulse">
            üëÅÔ∏è Perception: AI "ƒë·ªçc" ng∆∞·ªùi d√πng, FE "k·ªÉ" c√¢u chuy·ªán
          </h2>
          <img 
            src="https://i.imgflip.com/8zwv5a.jpg" 
            alt="meme perception" 
            class="mx-auto rounded-xl w-80 max-w-full my-4 shadow-lg"
            loading="lazy"
          />
          <p class="text-lg text-gray-700 dark:text-gray-300 mt-4 max-w-3xl mx-auto">
            AI c√≥ th·ªÉ ph√¢n t√≠ch intent, tone, theme v√† mood t·ª´ text. Nh∆∞ng <span class="font-bold text-blue-600 dark:text-blue-400">Frontend Developer</span> m·ªõi l√† ng∆∞·ªùi bi·∫øn nh·ªØng insights ƒë√≥ th√†nh UI c√≥ c·∫£m x√∫c, gi√∫p ng∆∞·ªùi d√πng c·∫£m th·∫•y ƒë∆∞·ª£c hi·ªÉu v√† quan t√¢m. üíô
          </p>
        </div>

        <!-- üí¨ Speaker Notes -->
        <aside class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4 rounded-r-lg mt-6">
          <h3 class="font-semibold text-lg mb-3 flex items-center gap-2">
            üí¨ Speaker Notes
          </h3>
          <ul class="list-disc list-inside text-gray-700 dark:text-gray-300 space-y-2 text-sm">
            <li>"AI gi·ªèi ph√¢n t√≠ch, nh∆∞ng FE gi·ªèi k·ªÉ chuy·ªán. Ch√∫ng ta kh√¥ng ch·ªâ hi·ªÉn th·ªã data - ta t·∫°o ra tr·∫£i nghi·ªám."</li>
            <li>"V√≠ d·ª•: AI bi·∫øt user ƒëang 'frustrated', nh∆∞ng FE m·ªõi l√†m cho button chuy·ªÉn m√†u ƒë·ªè nh·∫π, th√™m icon c·∫£m th√¥ng, hay hi·ªÉn th·ªã message ·∫•m √°p."</li>
            <li>"Perception layer kh√¥ng ph·∫£i l√† thay th·∫ø FE - n√≥ l√† c√¥ng c·ª• m·ªõi ƒë·ªÉ FE l√†m vi·ªác t·ªët h∆°n!"</li>
            <li>"B√¢y gi·ªù h√£y xem demo - AI ph√¢n t√≠ch intent, nh∆∞ng UI m·ªõi khi·∫øn n√≥ tr·ªü n√™n s·ªëng ƒë·ªông."</li>
          </ul>
        </aside>
      </section>
      <!-- üü° Seminar Presentation Section End -->

      <!-- Original Demo Section (unchanged) -->
      <div class="border-t-2 border-gray-200 dark:border-gray-700 pt-8 mt-8">
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Perception Demo
          </h1>
          <p class="text-gray-600 dark:text-gray-400">
            AI ph√¢n t√≠ch intent, tone, theme v√† mood t·ª´ input c·ªßa ng∆∞·ªùi d√πng
          </p>
        </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Input Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Input</h2>
          <textarea
            v-model="userInput"
            placeholder="Nh·∫≠p c√¢u h·ªèi ho·∫∑c y√™u c·∫ßu c·ªßa b·∫°n..."
            class="w-full h-32 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          ></textarea>
          <button
            @click="analyzeInput"
            :disabled="isAnalyzing || !userInput.trim()"
            class="mt-4 w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            {{ isAnalyzing ? 'ƒêang ph√¢n t√≠ch...' : 'Ph√¢n t√≠ch' }}
          </button>
        </div>

        <!-- Result Area -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">K·∫øt qu·∫£ ph√¢n t√≠ch</h2>
          
          <div v-if="analysisResult" class="space-y-4">
            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                Intent
              </div>
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                {{ analysisResult.intent }}
              </div>
            </div>

            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                Tone
              </div>
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                {{ analysisResult.tone }}
              </div>
            </div>

            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                Theme
              </div>
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                {{ analysisResult.theme }}
              </div>
            </div>

            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                Mood
              </div>
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                {{ analysisResult.mood }}
              </div>
            </div>
          </div>

          <div v-else class="text-center py-12 text-gray-400">
            K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
          </div>
        </div>
      </div>

      <!-- Agent Console -->
      <div class="mt-6 bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Agent Console</h2>
        <ConsoleLog :logs="consoleLogs" :is-thinking="isAnalyzing" />
      </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { sendPrompt } from '@/utils/ai';
import ConsoleLog from '@/components/agentic/ConsoleLog.vue';

const userInput = ref('');
const isAnalyzing = ref(false);
const analysisResult = ref(null);
const consoleLogs = ref([]);

function addLog(type, message) {
  consoleLogs.value.push({
    type,
    message,
    timestamp: Date.now()
  });
}

async function analyzeInput() {
  if (!userInput.value.trim()) return;

  isAnalyzing.value = true;
  analysisResult.value = null;
  addLog('info', 'B·∫Øt ƒë·∫ßu ph√¢n t√≠ch input...');
  addLog('info', `Input: "${userInput.value}"`);

  try {
    // G·ªçi AI ƒë·ªÉ ph√¢n t√≠ch
    const systemPrompt = `B·∫°n l√† AI chuy√™n ph√¢n t√≠ch intent, tone, theme v√† mood t·ª´ text. 
Tr·∫£ v·ªÅ JSON v·ªõi format:
{
  "intent": "inquiry|request|complaint|feedback|other",
  "tone": "formal|casual|friendly|neutral|urgent",
  "theme": "information|support|purchase|technical|other",
  "mood": "positive|neutral|negative|curious|excited"
}
Ch·ªâ tr·∫£ v·ªÅ JSON, kh√¥ng c√≥ text kh√°c.`;

    const response = await sendPrompt({
      role: 'system',
      prompt: systemPrompt + '\n\nUser input: ' + userInput.value,
      context: { input: userInput.value }
    });

    addLog('success', 'Nh·∫≠n ƒë∆∞·ª£c response t·ª´ AI');
    
    // Log response ƒë·ªÉ debug
    console.log('Response t·ª´ AI:', response);
    console.log('Response type:', typeof response);
    console.log('Response length:', response?.length);

    // Ki·ªÉm tra n·∫øu response r·ªóng
    if (!response || typeof response !== 'string' || response.trim().length === 0) {
      throw new Error('Response r·ªóng t·ª´ AI');
    }

    // Parse JSON response
    try {
      // Th·ª≠ parse tr·ª±c ti·∫øp
      const parsed = JSON.parse(response);
      analysisResult.value = parsed;
      addLog('success', 'Ph√¢n t√≠ch th√†nh c√¥ng');
    } catch (e) {
      console.warn('Parse JSON tr·ª±c ti·∫øp th·∫•t b·∫°i, th·ª≠ extract JSON:', e.message);
      
      // N·∫øu kh√¥ng parse ƒë∆∞·ª£c, th·ª≠ extract JSON t·ª´ text
      // Lo·∫°i b·ªè markdown code blocks n·∫øu c√≥
      let cleanedResponse = response
        .replace(/```json\s*/g, '')
        .replace(/```\s*/g, '')
        .trim();
      
      const jsonMatch = cleanedResponse.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        try {
          analysisResult.value = JSON.parse(jsonMatch[0]);
          addLog('success', 'Ph√¢n t√≠ch th√†nh c√¥ng (extracted JSON)');
        } catch (parseError) {
          console.error('Parse extracted JSON th·∫•t b·∫°i:', parseError);
          throw new Error(`Kh√¥ng th·ªÉ parse response: ${parseError.message}. Response: ${response.substring(0, 200)}`);
        }
      } else {
        console.error('Kh√¥ng t√¨m th·∫•y JSON trong response:', response);
        throw new Error(`Kh√¥ng th·ªÉ parse response: Kh√¥ng t√¨m th·∫•y JSON. Response: ${response.substring(0, 200)}`);
      }
    }
  } catch (error) {
    addLog('error', `L·ªói: ${error.message}`);
    // Fallback: t·∫°o mock result
    analysisResult.value = {
      intent: 'inquiry',
      tone: 'neutral',
      theme: 'information',
      mood: 'curious'
    };
  } finally {
    isAnalyzing.value = false;
  }
}
</script>

